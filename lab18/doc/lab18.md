# Лабораторна робота №18. ООП. Потоки

## 1 Вимоги

### 1.1 Розробник

* Рекало Іван Сергійович;
* студент групи КН923г;
* 13-вер-2024.

### 1.2 Завдання

**Поширити попередню лабораторну роботу таким чином**:
- використання функцій printf/scanf замінити на використання **cin/cout**;

- усі конкатенації рядків замінити на використання **stringstream**;
- замінити метод виводу інформації про об’єкт на метод, що повертає рядок-інформацію про об’єкт, який далі можна виводити на екран: **std::string& Phone::toString()**;
- замінити метод вводу інформації про об’єкт на метод, що приймає рядок з інформацією про об’єкт, обробляє його та створює об’єкт на базі цієї інформації
- поширити клас-список, шляхом реалізації методів роботи з файлами за допомогою файлових потоків (**fstream**) (якщо використовувалися функції fprintf/fscanf – замінити їх на класи **ifsteam/ofstream**), при цьому сигнатури методів повинні виглядати таким чином:

1. читання (List – клас-список об’єктів, при цьому слід пам’ятати, що при повторному читанні з файлу, попередні дані списку повинні бути очищені): **void List::readFromFile(std::string& fileName)**;
2. запис: **void List::writeToFile(std::string& fileName)**;

## 2 Опис програми

### 2.1 Функціональне призначення

Програма призначена для управління списком аудиторій, що містить інформацію про id та вмістимість кожної аудиторії. Вона дозволяє додавати нові аудиторії, видаляти існуючі, отримувати інформацію про аудиторію за індексом, здійснювати пошук великих аудиторій та робити запис та читання файлів

### 2.2 Опис логічної структури

#### Клас Audience
```C
class Audience {
```

*Призначення*: зберігає інформацію про аудиторію.

*Методи*:

- Конструктори
- Деструктор
- Оператор присвоєння
- Гетери та сетери для id та capacity
- Метод toString() та fromString() для читання файлу та запису у файл

#### Клас List
```C
class List {
```

*Призначення*: управляє списком об'єктів класу Audience.

*Методи*: 

- Конструктори
- Деструктор
- Оператор присвоєння
- addAudience(): додає аудиторію до списку
- removeAudience(): видаляє аудиторію за індексом
- getAudience(): повертає аудиторію за індексом
- print(): виводить всі аудиторії в списку
- findLargeAudiences(): шукає аудиторії з мінімальною вмістимістю
- readFromFile(): читає дані з файлу  
- writeToFile(): записує дані у файл

#### Головна функція
```C
int main();
```

*Призначення*: головна функція main є точкою входу в програму, де здійснюється ініціалізація даних, управління списком аудиторій і виведення результатів. Також вона відповідає за створення, додавання і видалення аудиторій зі списку, отримання доступу до аудиторій, пошуку аудиторій за вмістимістю, та запис даних у файл і читання їх з файлу

*Опис роботи*:

- Створення списку аудиторій: Ініціалізується об'єкт List, який буде використовуватися для зберігання аудиторій
- Додавання аудиторій до списку: Створюються два об'єкти Audience (a1 з ідентифікатором 1 і місткістю 100 та a2 з ідентифікатором 2 і місткістю 200) і додаються до списку методом addAudience.
- Виведення всіх аудиторій: Викликається метод print для об'єкта list, який виводить на екран інформацію про всі аудиторії у списку.
- Видалення аудиторії: Видаляється аудиторія за індексом 1 методом removeAudience, після чого список знову виводиться на екран для відображення змін.
- Додавання нової аудиторії: Створюється новий об'єкт Audience (a3 з ідентифікатором 3 і місткістю 300) і додається до списку
- Отримання даних про аудиторію за індексом: За допомогою методу getAudience програма намагається отримати дані про аудиторію з індексом 1. Якщо індекс вірний, дані аудиторії виводяться на екран.
- Спроба отримати дані про аудиторію за неправильним індексом: Програма намагається отримати дані про аудиторію з неіснуючим індексом (10) і виводить відповідне повідомлення про помилку.
- Пошук великих аудиторій: Використовується метод findLargeAudiences для пошуку аудиторій з вмістимістю більше ніж 150. Якщо такі аудиторії знайдено, вони виводяться на екран. Якщо ні, виводиться повідомлення, що великих аудиторій не знайдено.
- Запис у файл: за допомогою метода writeToFile дані записуються у визначений файл
- Читання з файлу: використовується метод readFromFile для зчитування даних з файлу

#### Структура проекту
```
                 └── lab18
                     ├── Makefile
                     ├── Doxyfile
                     ├── README.md
                     ├── doc
                         └── lab18.md
                     ├── src
                         ├── list.cpp
                         ├── list.h
                         ├── main.cpp
                         ├── entity.cpp
                         ├── entity.h
                     └── test
                         └── test.cpp
```

### 2.3 Важливі фрагменти програми

#### Конструктор Audience
```C
Audience::Audience(int id, int capacity) : id(id), capacity(capacity) {
    cout << "Конструктор з параметрами викликаний: id = " << id << ", capacity = " << capacity << endl;
}
```

#### Метод toString
```C
string Audience::toString() const {
    stringstream ss;
    ss << "Audience ID: " << id << ", Capacity: " << capacity;
    return ss.str();
}
```

#### Метод fromString
```C
void Audience::fromString(const string& data) {
    size_t idPos = data.find("ID: ");
    size_t capacityPos = data.find(", Capacity: ");
    
    if (idPos != string::npos && capacityPos != string::npos) {
        id = std::stoi(data.substr(idPos + 4, capacityPos - (idPos + 4)));
        capacity = std::stoi(data.substr(capacityPos + 12));
    }
}
```

#### Метод writeToFIle
```C
void List::writeToFile(const string& fileName) const {
    ofstream file(fileName);
    if (!file) {
        cerr << "Помилка відкриття файлу для запису" << endl;
        return;
    }

    for (size_t i = 0; i < size; ++i) {
        file << audiences[i].toString() << endl;
    }

    file.close();
}
```

#### Метод readFromFIle
```C
void List::readFromFile(const string& fileName) {
    ifstream file(fileName);
    if (!file) {
        cerr << "Помилка відкриття файлу для читання" << endl;
        return;
    }

    string line;
    while (getline(file, line)) {
        Audience audience;
        audience.fromString(line);
        addAudience(audience);
    }

    file.close();
}
```

#### Метод addAudience
```C
void List::addAudience(const Audience& audience, size_t pos) {
    if (size >= capacity) {
        size_t newCapacity = (capacity == 0) ? 1 : capacity * 2;
        Audience* newAudiences = new Audience[newCapacity];
        std::copy(audiences, audiences + size, newAudiences);
        delete[] audiences;
        audiences = newAudiences;
        capacity = newCapacity;
    }
    if (pos > size) pos = size;
    for (size_t i = size; i > pos; --i) {
        audiences[i] = audiences[i - 1];
    }
    audiences[pos] = audience;
    ++size;
}
```

#### Метод print
```C
void List::print() const {
    for (size_t i = 0; i < size; ++i) {
        cout << audiences[i].toString() << endl;
    }
}
```

#### Перевірка відсутності витоків пам'яті за допомогою утиліти valgrind
```C
==57502== Memcheck, a memory error detector
==57502== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==57502== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==57502== Command: ./main
==57502== 
Конструктор List викликаний
Конструктор з параметрами викликаний: id = 1, capacity = 100
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 1, capacity = 100
Конструктор з параметрами викликаний: id = 2, capacity = 200
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 1, capacity = 100
Оператор присвоєння викликаний: id = 1, capacity = 100
Оператор присвоєння викликаний: id = 2, capacity = 200
Всі аудиторії:
Audience ID: 2, Capacity: 200
Audience ID: 1, Capacity: 100

Видалення аудиторії з індексом 1:
Audience ID: 2, Capacity: 200
Конструктор з параметрами викликаний: id = 3, capacity = 300
Оператор присвоєння викликаний: id = 2, capacity = 200
Оператор присвоєння викликаний: id = 3, capacity = 300

Додавання аудиторії:
Audience ID: 3, Capacity: 300
Audience ID: 2, Capacity: 200

Отримання даних про аудиторію з індексом 1:
Audience ID: 2, Capacity: 200

Спроба отримати дані про аудиторію з індексом 10:
Помилка: Індекс поза межами
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 3, capacity = 300
Оператор присвоєння викликаний: id = 2, capacity = 200

Великі аудиторії:
Audience ID: 3, Capacity: 300
Audience ID: 2, Capacity: 200
Деструктор викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 3, capacity = 300

Дані записані у файл: audiences.txt
Конструктор List викликаний
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 3, capacity = 300
Деструктор викликаний: id = 3, capacity = 300
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 3, capacity = 300
Деструктор викликаний: id = 3, capacity = 300
Оператор присвоєння викликаний: id = 3, capacity = 300
Оператор присвоєння викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 2, capacity = 200

Дані прочитані з файлу:
Audience ID: 2, Capacity: 200
Audience ID: 3, Capacity: 300
Деструктор викликаний: id = 3, capacity = 300
Деструктор викликаний: id = 2, capacity = 200
Деструктор List викликаний
Деструктор викликаний: id = 3, capacity = 300
Деструктор викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 3, capacity = 300
Деструктор List викликаний
==57502== 
==57502== HEAP SUMMARY:
==57502==     in use at exit: 0 bytes in 0 blocks
==57502==   total heap usage: 38 allocs, 38 frees, 97,922 bytes allocated
==57502== 
==57502== All heap blocks were freed -- no leaks are possible
==57502== 
==57502== For lists of detected and suppressed errors, rerun with: -s
==57502== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
```

#### Модульний тест
```C
./dist/test.bin
Конструктор за замовчуванням викликаний
Тест конструктора пройдено!
Конструктор з параметрами викликаний: id = 3, capacity = 300
Тест конструктора з параметрами пройдено!
Тест гетерів та сетерів пройдено!
Конструктор з параметрами викликаний: id = 10, capacity = 150
Тест методу, що повертає рядок-інформацію про об'єкт пройдено!
Конструктор за замовчуванням викликаний
Тест методу, що приймає рядок з інформацією про об'єкт пройдено!
Деструктор викликаний: id = 11, capacity = 350
Деструктор викликаний: id = 10, capacity = 150
Деструктор викликаний: id = 3, capacity = 300
Деструктор викликаний: id = 5, capacity = 500
Конструктор List викликаний
Конструктор з параметрами викликаний: id = 1, capacity = 100
Конструктор з параметрами викликаний: id = 2, capacity = 200
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 1, capacity = 100
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 1, capacity = 100
Оператор присвоєння викликаний: id = 1, capacity = 100
Оператор присвоєння викликаний: id = 2, capacity = 200
Конструктор List викликаний
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 2, capacity = 200
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 2, capacity = 200
Оператор присвоєння викликаний: id = 2, capacity = 200
Оператор присвоєння викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 1, capacity = 100
ID з індексом 0: 1
ID з індексом 1: 2
Тест операцій з файлом пройдено!
Деструктор викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 1, capacity = 100
Деструктор List викликаний
Деструктор викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 2, capacity = 200
Деструктор List викликаний
Конструктор List викликаний
Конструктор з параметрами викликаний: id = 1, capacity = 100
Конструктор з параметрами викликаний: id = 2, capacity = 200
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 1, capacity = 100
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 1, capacity = 100
Оператор присвоєння викликаний: id = 1, capacity = 100
Оператор присвоєння викликаний: id = 2, capacity = 200
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 2, capacity = 200
Оператор присвоєння викликаний: id = 1, capacity = 100
Конструктор копіювання List викликаний
ID з індексом 0: 2
ID з індексом 1: 1
Тест конструктора копіювання не пройдено!
Конструктор List викликаний
Конструктор за замовчуванням викликаний
Конструктор за замовчуванням викликаний
Оператор присвоєння викликаний: id = 2, capacity = 200
Оператор присвоєння викликаний: id = 1, capacity = 100
Оператор присвоєння List викликаний
ID з індексом 0: 2
ID з індексом 1: 1
Тест оператора присвоєння не пройдено!
Деструктор викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 2, capacity = 200
Деструктор List викликаний
Деструктор викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 2, capacity = 200
Деструктор List викликаний
Деструктор викликаний: id = 2, capacity = 200
Деструктор викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 1, capacity = 100
Деструктор викликаний: id = 2, capacity = 200
Деструктор List викликаний
Всі тести пройдено!
```

## 3 Варіанти використання

#### Програма може бути використана для:

1. Розробка програмного забезпечення для управління об'єктами
2. Автоматизація управління приміщеннями в навчальних закладах
3. Пошук та аналіз аудиторій за заданими критеріями
4. Управління списком аудиторій

## Висновки

Лабораторна робота занурила нас у ООП та навчила робити з потоками cin та cout, які значно спрощують роботу з програмою. Навчила використовувати stringstream для будування рядків з потоками. Познайомила нас з toString та fromString для дотримання інкапсуляції і навчила робити з потоками fstream для спрощення роботи з файлами, для безпечнішого та бистрішого управління даними у файлах та їх збереження.